from sklearn.tree import DecisionTreeClassifier
from sklearn.preprocessing import LabelEncoder
import joblib
import os

# --------------------------
# 1. ุจูุงูุงุช ุงูุชุฏุฑูุจ ุงูููุณุนุฉ ูุน ุฌููุน ุงูุชุตูููุงุช
# --------------------------
training_data = [
    # ุงูุจูุงูุงุช ุงูุฃุตููุฉ ุงููุญุณูุฉ
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 500, "ุงูููุงุตูุงุช": 100, "ุงูุชุณูู": 900}, "ููู ูู ุงูุชุณูู"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 300, "ุงูููุงุตูุงุช": 400, "ุงูุชุณูู": 200}, "ูุตุฑูู ุงูููู ูุฑุชูุน"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 700, "ุงูููุงุตูุงุช": 200, "ุงูุชุณูู": 100}, "ุงูุทุนุงู ูุฑุชูุน"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 200, "ุงูููุงุตูุงุช": 100, "ุงูุชุณูู": 150}, "ูุตุฑูู ุฌูุฏ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 400, "ุงูููุงุตูุงุช": 600, "ุงูุชุณูู": 300}, "ุงูุชููู ูุฑุชูุน"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 1000, "ุงูููุงุตูุงุช": 100, "ุงูุชุณูู": 100}, "ุงูุทุนุงู ูุณุชููู ุงูููุฒุงููุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 200, "ุงูููุงุตูุงุช": 800, "ุงูุชุณูู": 100}, "ุงูููุงุตูุงุช ูุฑุชูุนุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 300, "ุงูููุงุตูุงุช": 300, "ุงูุชุณูู": 300}, "ุงูุฅููุงู ูุชูุงุฒู"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 600, "ุงูููุงุตูุงุช": 100, "ุงูุชุณูู": 600}, "ุชูุงุฒู ุจูู ุงูุทุนุงู ูุงูุชุณูู ูุทููุจ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 100, "ุงูููุงุตูุงุช": 100, "ุงูุชุณูู": 900}, "ุงูุชุณูู ูุณุชูุฒู ุงูููุฒุงููุฉ"),

    # ุจูุงูุงุช ุฌุฏูุฏุฉ ูุน ูุฆุงุช ุฅุถุงููุฉ
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 400, "ุงูููุงุชูุฑ": 500, "ุงูุฅูุฌุงุฑ": 800}, "ุงูููุงุชูุฑ ูุงูุฅูุฌุงุฑ ูุฑุชูุนุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 300, "ุงูุชุฑููู": 600, "ุงูุชุณูู": 400}, "ุงูุชุฑููู ูุฑุชูุน"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 200, "ุงูุตุญุฉ": 800, "ุงูุชุนููู": 300}, "ูุตุฑููุงุช ุงูุตุญุฉ ูุฑุชูุนุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 500, "ุงูุณูุฑ": 1200, "ุงููุฏุงูุง": 200}, "ูุตุฑููุงุช ุงูุณูุฑ ูุฑุชูุนุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 400, "ุงูุตูุงูุฉ": 700, "ุฃุฎุฑู": 300}, "ูุตุฑููุงุช ุงูุตูุงูุฉ ูุฑุชูุนุฉ"),
    
    # ุจูุงูุงุช ูุน ูุฆุงุช ุงูุฏุฎู
    ({"ุงูุฑุงุชุจ": 2000, "ุงูุนูู ุงูุญุฑ": 500, "ุงูุงุณุชุซูุงุฑุงุช": 300}, "ุฏุฎู ูุชููุน ูุฌูุฏ"),
    ({"ุงูุฑุงุชุจ": 1500, "ุงูุนูู ุงูุญุฑ": 200, "ุงููุฏุงูุง": 100}, "ููุฑ ูู ุฒูุงุฏุฉ ูุตุงุฏุฑ ุงูุฏุฎู"),
    ({"ุงูุฑุงุชุจ": 3000, "ุงูุงุณุชุซูุงุฑุงุช": 800, "ุงูุนูู ุงูุญุฑ": 400}, "ุฏุฎู ููุชุงุฒ ููุชููุน"),
    
    # ุจูุงูุงุช ูุฎุชูุทุฉ (ุฏุฎู ููุตุฑููุงุช)
    ({"ุงูุฑุงุชุจ": 2500, "ุงูุทุนุงู ูุงูุดุฑุงุจ": 600, "ุงูููุงุตูุงุช": 300, "ุงูุชุณูู": 400}, "ุฑุงูุจ ูุตุฑูู ุงูุชุณูู"),
    ({"ุงูุฑุงุชุจ": 1800, "ุงูุทุนุงู ูุงูุดุฑุงุจ": 400, "ุงูููุงุชูุฑ": 300, "ุงูุฅูุฌุงุฑ": 600}, "ุงูุฅูุฌุงุฑ ูุฑุชูุน ูุณุจูุงู"),
    ({"ุงูุนูู ุงูุญุฑ": 1000, "ุงูุทุนุงู ูุงูุดุฑุงุจ": 300, "ุงูุชุฑููู": 500, "ุงูุชุนููู": 200}, "ุงูุชุฑููู ูุฑุชูุน"),
    
    # ุจูุงูุงุช ุฅุถุงููุฉ ูููุฆุงุช ุงูุฌุฏูุฏุฉ
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 350, "ุงูููุงุชูุฑ": 400, "ุงูุฅูุฌุงุฑ": 700, "ุงูููุงุตูุงุช": 250}, "ูุตุฑููุงุช ุฃุณุงุณูุฉ ูุชูุงุฒูุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 450, "ุงูุชุณูู": 800, "ุงูุชุฑููู": 600, "ุงููุฏุงูุง": 300}, "ุงูุชุฑููู ูุงูุชุณูู ูุฑุชูุนุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 280, "ุงูุตุญุฉ": 600, "ุงูุชุนููู": 400, "ุงูุตูุงูุฉ": 200}, "ูุตุฑููุงุช ุงูุตุญุฉ ูุงูุชุนููู ูุฑุชูุนุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 320, "ุงูุณูุฑ": 1500, "ุงููุฏุงูุง": 400, "ุฃุฎุฑู": 150}, "ูุตุฑููุงุช ุงูุณูุฑ ูุฑุชูุนุฉ ุฌุฏุงู"),
    
    # ุจูุงูุงุช ูุน ูุณุจ ูุฎุชููุฉ
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 150, "ุงูููุงุตูุงุช": 80, "ุงูุชุณูู": 120, "ุงูุชุฑููู": 100}, "ุฅููุงู ูุชูุงุฒู ูููุจูู"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 800, "ุงูููุงุตูุงุช": 400, "ุงูุชุณูู": 300, "ุงูููุงุชูุฑ": 200}, "ุงูุทุนุงู ูุงูููุงุตูุงุช ูุฑุชูุนุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 250, "ุงูููุงุชูุฑ": 350, "ุงูุฅูุฌุงุฑ": 800, "ุงูุตุญุฉ": 300}, "ุงูุฅูุฌุงุฑ ูุฑุชูุน"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 400, "ุงูุชุนููู": 600, "ุงูุณูุฑ": 800, "ุงููุฏุงูุง": 200}, "ุงูุชุนููู ูุงูุณูุฑ ูุฑุชูุนุฉ"),
    
    # ุจูุงูุงุช ูุน ูุฆุงุช ุฃุฎุฑู
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 300, "ุงูุตูุงูุฉ": 500, "ุฃุฎุฑู": 400, "ุงููุฏุงูุง": 150}, "ูุตุฑููุงุช ุงูุตูุงูุฉ ูุฑุชูุนุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 350, "ุงูุชุฑููู": 700, "ุงูุชุณูู": 450, "ุงูุณูุฑ": 300}, "ุงูุชุฑููู ูุฑุชูุน"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 200, "ุงูุชุนููู": 800, "ุงูุตุญุฉ": 400, "ุงูููุงุชูุฑ": 250}, "ุงูุชุนููู ูุฑุชูุน"),
    
    # ุจูุงูุงุช ุฅุถุงููุฉ ููุชุญุณูู
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 180, "ุงูููุงุตูุงุช": 120, "ุงูุชุณูู": 80, "ุงูุชุฑููู": 60}, "ุฅููุงู ููุชุงุฒ ููุชูุงุฒู"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 900, "ุงูููุงุตูุงุช": 300, "ุงูุชุณูู": 200, "ุงูููุงุชูุฑ": 150}, "ุงูุทุนุงู ูุฑุชูุน ุฌุฏุงู"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 220, "ุงูููุงุชูุฑ": 280, "ุงูุฅูุฌุงุฑ": 750, "ุงูุตุญุฉ": 180}, "ุงูุฅูุฌุงุฑ ูุฑุชูุน"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 380, "ุงูุชุนููู": 650, "ุงูุณูุฑ": 900, "ุงููุฏุงูุง": 120}, "ุงูุชุนููู ูุงูุณูุฑ ูุฑุชูุนุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 280, "ุงูุตูุงูุฉ": 450, "ุฃุฎุฑู": 320, "ุงูุชุฑููู": 200}, "ูุตุฑููุงุช ุงูุตูุงูุฉ ูุฑุชูุนุฉ"),
    
    # ุจูุงูุงุช ูุน ุฏุฎู ูุชููุน
    ({"ุงูุฑุงุชุจ": 2200, "ุงูุนูู ุงูุญุฑ": 600, "ุงูุงุณุชุซูุงุฑุงุช": 400, "ุงูุทุนุงู ูุงูุดุฑุงุจ": 400}, "ุฏุฎู ุฌูุฏ ููุชููุน"),
    ({"ุงูุฑุงุชุจ": 1600, "ุงูุนูู ุงูุญุฑ": 300, "ุงููุฏุงูุง": 150, "ุงูุทุนุงู ูุงูุดุฑุงุจ": 350}, "ููุฑ ูู ุฒูุงุฏุฉ ุงูุฏุฎู"),
    ({"ุงูุฑุงุชุจ": 2800, "ุงูุงุณุชุซูุงุฑุงุช": 600, "ุงูุนูู ุงูุญุฑ": 500, "ุงูููุงุตูุงุช": 250}, "ุฏุฎู ููุชุงุฒ"),
    
    # ุจูุงูุงุช ูุฎุชูุทุฉ ุฅุถุงููุฉ
    ({"ุงูุฑุงุชุจ": 2400, "ุงูุทุนุงู ูุงูุดุฑุงุจ": 450, "ุงูููุงุตูุงุช": 280, "ุงูุชุณูู": 350, "ุงูุชุฑููู": 200}, "ุฑุงูุจ ูุตุฑูู ุงูุชุณูู"),
    ({"ุงูุฑุงุชุจ": 1700, "ุงูุทุนุงู ูุงูุดุฑุงุจ": 320, "ุงูููุงุชูุฑ": 280, "ุงูุฅูุฌุงุฑ": 650, "ุงูุตุญุฉ": 180}, "ุงูุฅูุฌุงุฑ ูุฑุชูุน ูุณุจูุงู"),
    ({"ุงูุนูู ุงูุญุฑ": 1200, "ุงูุทุนุงู ูุงูุดุฑุงุจ": 280, "ุงูุชุฑููู": 450, "ุงูุชุนููู": 180, "ุงูุณูุฑ": 300}, "ุงูุชุฑููู ูุฑุชูุน"),
    
    # ุจูุงูุงุช ููุงุฆูุฉ ููุชุญุณูู
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 160, "ุงูููุงุตูุงุช": 100, "ุงูุชุณูู": 70, "ุงูุชุฑููู": 50, "ุงูููุงุชูุฑ": 200}, "ุฅููุงู ููุชุงุฒ ููุชูุงุฒู"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 950, "ุงูููุงุตูุงุช": 250, "ุงูุชุณูู": 180, "ุงูููุงุชูุฑ": 120, "ุงูุฅูุฌุงุฑ": 600}, "ุงูุทุนุงู ูุฑุชูุน ุฌุฏุงู"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 200, "ุงูููุงุชูุฑ": 250, "ุงูุฅูุฌุงุฑ": 700, "ุงูุตุญุฉ": 150, "ุงูุชุนููู": 300}, "ุงูุฅูุฌุงุฑ ูุฑุชูุน"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 350, "ุงูุชุนููู": 600, "ุงูุณูุฑ": 850, "ุงููุฏุงูุง": 100, "ุงูุตูุงูุฉ": 200}, "ุงูุชุนููู ูุงูุณูุฑ ูุฑุชูุนุฉ"),
    ({"ุงูุทุนุงู ูุงูุดุฑุงุจ": 250, "ุงูุตูุงูุฉ": 400, "ุฃุฎุฑู": 280, "ุงูุชุฑููู": 180, "ุงูุชุณูู": 120}, "ูุตุฑููุงุช ุงูุตูุงูุฉ ูุฑุชูุนุฉ"),
]

# --------------------------
# 2. ุชุฌููุฒ ุงูุจูุงูุงุช ูููููุฐุฌ
# --------------------------
# ุชุญุฏูุฏ ุฌููุน ุงููุฆุงุช ุงููุญุชููุฉ
all_categories = [
    "ุงูุทุนุงู ูุงูุดุฑุงุจ", "ุงูููุงุตูุงุช", "ุงูุชุณูู", "ุงูููุงุชูุฑ", "ุงูุฅูุฌุงุฑ", 
    "ุงูุชุฑููู", "ุงูุตุญุฉ", "ุงูุชุนููู", "ุงูุณูุฑ", "ุงููุฏุงูุง", "ุงูุตูุงูุฉ", "ุฃุฎุฑู",
    "ุงูุฑุงุชุจ", "ุงูุนูู ุงูุญุฑ", "ุงูุงุณุชุซูุงุฑุงุช"
]

# ุชุญููู ุงูุจูุงูุงุช ุฅูู ูุตูููุงุช ุฑูููุฉ
X = []
for entry in training_data:
    # ุฅูุดุงุก ูุงุฆูุฉ ุจุฃุตูุงุฑ ูุฌููุน ุงููุฆุงุช
    features = [0] * len(all_categories)
    
    # ููุก ุงูููู ุงูููุฌูุฏุฉ
    for category, amount in entry[0].items():
        if category in all_categories:
            idx = all_categories.index(category)
            features[idx] = amount
    
    X.append(features)

y = [entry[1] for entry in training_data]

# --------------------------
# 3. ุชุฏุฑูุจ ุงููููุฐุฌ
# --------------------------
label_encoder = LabelEncoder()
y_encoded = label_encoder.fit_transform(y)

model = DecisionTreeClassifier(random_state=42, max_depth=10)
model.fit(X, y_encoded)

# --------------------------
# 4. ุญูุธ ุงููููุฐุฌ ูุงููุญูู
# --------------------------
os.makedirs("models", exist_ok=True)

joblib.dump(model, "models/advice_model.pkl")
joblib.dump(label_encoder, "models/label_encoder.pkl")
joblib.dump(all_categories, "models/categories.pkl")

print("โ ุชู ุฅูุดุงุก ุงููููุฐุฌ ุจูุฌุงุญ ูุชู ุญูุธู ูู ูุฌูุฏ models/")
print(f"๐ ุนุฏุฏ ุจูุงูุงุช ุงูุชุฏุฑูุจ: {len(training_data)}")
print(f"๐ท๏ธ ุนุฏุฏ ุงููุฆุงุช ุงููุฏุนููุฉ: {len(all_categories)}")
print(f"๐ก ุนุฏุฏ ุงููุตุงุฆุญ ุงููุฎุชููุฉ: {len(set(y))}")
print("\n๐ ุงููุฆุงุช ุงููุฏุนููุฉ:")
for i, category in enumerate(all_categories, 1):
    print(f"   {i}. {category}")
